<div class="survey-dashboard">
  <app-navbar></app-navbar><div class="container" *ngIf="!loading; else loadingTpl">
  <div class="header">
    <button class="btn-back" [routerLink]="['/templates']">Back to list</button>
    <div class="title">
      <h2>{{ tpl?.name }}</h2>
      <span class="badge" [class.active]="tpl?.activeStatusId">{{ tpl?.activeStatusId ? 'ACTIVE' : 'INACTIVE' }}</span>
    </div>
  </div>

  <div class="alert error" *ngIf="errorMsg">{{ errorMsg }}</div>
  <div class="alert success" *ngIf="successMsg">{{ successMsg }}</div>

  <div class="card">
    <div class="rows" *ngIf="rows?.length; else emptyTpl">
      <div class="row" *ngFor="let row of rows">
        <div class="col" *ngFor="let f of row.fields">
          <label class="field-label">
            {{ f.label }} <span *ngIf="f.required" class="req">*</span>
          </label>

          <ng-container [ngSwitch]="f.type">
            <input *ngSwitchCase="'text'" class="input" [placeholder]="f.placeholder" [(ngModel)]="f.answer" />
            <input *ngSwitchCase="'number'" type="number" class="input" [(ngModel)]="f.answer" />
            <textarea *ngSwitchCase="'textarea'" class="input" [(ngModel)]="f.answer"></textarea>

            <div *ngSwitchCase="'radio'" class="radio-group">
              <label *ngFor="let opt of f.options" class="radio">
                <input type="radio" [name]="f.id" [value]="opt.value" [(ngModel)]="f.answer" />
                {{ opt.label }}
              </label>
            </div>

<div *ngSwitchCase="'checkbox'" class="checkbox-group">
  <label *ngFor="let opt of f.options" class="checkbox">
    <input
      #cb
      type="checkbox"
      [checked]="hasOption(f, opt.value)"
      (change)="onToggleCheckbox(f, opt.value, cb.checked)" />
    {{ opt.label }}
  </label>
</div>


            <select *ngSwitchCase="'select'" class="input" [(ngModel)]="f.answer">
              <option [ngValue]="''" disabled selected>-- choose --</option>
              <option *ngFor="let opt of f.options" [ngValue]="opt.value">{{ opt.label }}</option>
            </select>

            <input *ngSwitchCase="'date'" type="date" class="input" [(ngModel)]="f.answer" />
            <input *ngSwitchDefault class="input" [(ngModel)]="f.answer" />
          </ng-container>

          <small class="error" *ngIf="isInvalid(f)">Champ requis</small>
        </div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button class="btn outline" [disabled]="submitting" (click)="saveDraft()">Save draft</button>
    <button class="btn primary" [disabled]="submitting || !canSubmit()" (click)="submit(true)">Submit</button>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading">Loadingâ€¦</div>
</ng-template>

<ng-template #emptyTpl>
  <div class="empty">Ce template ne contient aucun champ.</div>
</ng-template>

</div>
